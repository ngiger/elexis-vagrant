#!/bin/bash -v
# Bootstrap all stuff needed for a Debian Wheezy based Jenkins-CI setup
# Must be run as user root
# Fastest way to run it is "wget https://raw.github.com/ngiger/elexis-vagrant/master/shell/bootstrap_wheezy && bash -v bootstrap_wheezy"
aptitude install git etckeeper sudo
git config --system credential.helper cache "cache --timeout=3600" # keep it in cache for 60 minutes
git config --system  user.name "admin"
git config --system user.email admin@`hostname -f`
cd /etc
git add gitconfig
echo puppet | tee --append /etc/.gitignore
git rm -rf /etc/puppet
cd /etc && git commit -a -m "Bootstrapping srv_elexis"
git clone https://github.com/ngiger/elexis-vagrant.git /etc/puppet
mkdir -p /opt/src
ln -s /opt/src/vagrant-ngiger /etc/puppet
aptitude update
aptitude remove puppet facter
apt-get  build-dep puppet
aptitude install libaugeas-ruby augeas-tools gcc build-essential zlib1g zlib1g-dev
cd /etc/puppet
gem install --no-ri --no-rdoc bundler && bundle install
/etc/puppet/runpuppet /etc/puppet/manifests/site.pp 2>&1 | tee /var/log/puppet_`date +\"%Y-%m-%d_%H:%M:%S\"`.log

