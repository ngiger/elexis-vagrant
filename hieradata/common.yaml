---
# definition of postgresql database
# unfortunately the syntax via puppet is signifcantly different so we need a different variable for mysql!
pg_dbs:
  -
    db_name: elexis
    db_user: elexis
    # specify either db_password or db_pw_hash
    # puppet apply --execute 'notify { "test": message => postgresql_password("elexis", "elexisTest") }' --modulepath /vagrant/modules/  
    db_password: "thisPasswordOverrideBy db_pw_hash"
    db_pw_hash: md5e0925320617bda379cf9db294f07caf2
    # SELECT or UPDATE are not supported, only worked with ALL
    db_privileges: ALL
  -
    db_name: test
    db_user: elexis
    db_pw_hash: md5e0925320617bda379cf9db294f07caf2
    db_privileges: ALL
  -
    db_name: elexis
    db_user: reader
    db_password: elexisTest
    db_privileges: 'ALL'
  -
    db_name: test
    db_user: reader
    db_password: elexisTest
    db_privileges: ALL

mysql_dbs:
  -
    db_name: elexis
    db_user: elexis@%
    # specify either db_password or db_pw_hash
#     # puppet apply --execute 'notify { "test": message => mysql_password("elexisTest") }' --modulepath /vagrant/modules/  
    db_password: "thisPasswordOverrideBy db_pw_hash"
    db_pw_hash: "*0B9FC6091D135BD4050DDBCA19FC9F73D7527C8B"
    # Or specify individual privileges with columns from the mysql.db table:
    # privileges => ['Select_priv', 'Insert_priv', 'Update_priv', 'Delete_priv']

    db_privileges: ALL
  -
    db_name: test
    db_user: elexis@%
    db_pw_hash: "*0B9FC6091D135BD4050DDBCA19FC9F73D7527C8B"
    db_privileges: ALL
  -
    db_name: elexis
    db_user: reader@%
    db_password: elexisTest
    db_privileges: 'Select_priv'
  -
    db_name: test
    db_user: reader@%
    db_password: elexisTest
    db_privileges: Select_priv

editor::default:   /usr/bin/vim.nox
editor::package:   vim-nox
elexis::default_eclipse:      eclipse-rcp-juno-SR2
elexis::jenkinsDir:           /opt/jenkins
elexis::eclipseRelease:       juno
elexis::default_eclipse:      eclipse-rcp-juno-SR2
elexis::downloadURL:          http://ftp.medelexis.ch/downloads_opensource
elexis::apt_prox_host:        172.25.1.233
elexis::apt_prox_port:        3142
elexis::db_type:   pg
elexis::db_server: server
elexis::db_backup: backup
elexis::db_server::backup_server_is: backup
elexis::db_port:   3306
elexis::db_user:   elexis
elexis::db_password:   elexisTest # password of main DB user
# elexis::db_pw_hash:    elexisTest # or better and used if present password hash of main DB user
elexis::db_main:   elexis   # Name of DB to use for production
elexis::db_test:   test     # Name of test DB to use for production
elexis::pg_dump_dir:         /home/postgresql/dumps/
elexis::pg_backup_dir:       /home/postgresql/backups/
elexis::pg_backup_files:     /home/postgresql/dumps/elexis.dump*.gz
elexis::pg_switch_script:     /usr/local/bin/pg_switch.sh

# On debian passwordhash can be generate using mkpasswd -m sha-512 yourPassword
passwords:
  rgw:
    password: '$6$y.DmNxI9ibt$u656hqnBunFDHZaOmO/VM60ENoVLxoTC9pyfofAcwbfef4sV39hXN/jYAM4V/SPbKbpYCuVZE743.ZDjFEVpC0' # was 8200
  thomashu:
    password: '$6$XfboSHLp$2dbGluTUvur1WlGY3jcskxN/4iMp2m95C97PRyVxU1wsITkM45lkqjvz1nJRk.ujOJlvPdJO7CsXeJgZ08oPJ.' # was 6840
  
users_devel:
  rgw:
    ensure: present
    uid: 1201
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: Without him there would be no Elexis. Thanks a lot!
    managehome: true
    shell: /bin/bash
    password: '$6$y.DmNxI9ibt$u656hqnBunFDHZaOmO/VM60ENoVLxoTC9pyfofAcwbfef4sV39hXN/jYAM4V/SPbKbpYCuVZE743.ZDjFEVpC0' # was 8200
  thomashu:
    ensure: present
    uid: 1202
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: Core developer
    managehome: true
    shell: /bin/bash
    password: '$6$XfboSHLp$2dbGluTUvur1WlGY3jcskxN/4iMp2m95C97PRyVxU1wsITkM45lkqjvz1nJRk.ujOJlvPdJO7CsXeJgZ08oPJ.' # was 6840
  marcode79:
    ensure: present
    uid: 1203
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: Core developer and responsible for the database versions
    managehome: true
    shell: /bin/bash
    password: '$6$XfboSHLp$2dbGluTUvur1WlGY3jcskxN/4iMp2m95C97PRyVxU1wsITkM45lkqjvz1nJRk.ujOJlvPdJO7CsXeJgZ08oPJ.' # was 6840
  jsigle:
    ensure: present
    uid: 1204
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: Our LibreOffice guru and bug fixer
    managehome: true
    shell: /bin/bash
    password: '$6$GJvs7SLbFkWzv3j$63jbsREdXBCGsbls.fsdNGeKzp3hHXEAxrw4r9YDjgHB8QCEj.M.BdqAO5cASLYclhKAfxINVXxjZz4UOOOqj0' # was 3004
  freakyPenguin:
    ensure: present
    uid: 1205
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: ODF text plugin and hilotec KG
    managehome: true
    shell: /bin/bash
    password: '$6$0gxFH7BZp$AE/WvqtBBnTQovhkgxN6vaxQl4AFo7GH3i2eTxqA2UW5prnjikDNnbBauIoy8OwTqfcuzqxtlLbDZIw9LfCUd1'  # was 3550
    
  niklaus:
    ensure: present
    uid: 1206
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: The elexis release manager
    managehome: true
    shell: /bin/bash
    # was 8753
    password: '$6$YIy.xAQcKOXUY9CU$dqun8A3EZ7i/wKP9C/lqriWApx9GwRuDMy5psPlL2JSTm4d/dJvU4tSIYnFs81uSVyuE2FkwI.K/jzqj01JVH1'

users_elexis:
  arzt:
    ensure: present
    uid: 1500
    groups:  [ adm, dialout, cdrom, elexis, plugdev, netdev, rvm, sudo ]
    comment: elexis
    managehome: true
    password: '$6$4OQ1nIYTLfXE$xFV/8f6MIAo6XKZg8fYbF//w1lhFrCJ60JMcptwESgbHaH52c2UZbUUAAlydCRQy9wDYEgt5dUpTyHjFhCy5E.'

# For each of the trusted_hosts we will do the following
# The users elexis and postgres (without shell) will be able to execute ssh (password-less) commands on each of the other hosts
# This is done via generating for each host a separate RSA key under hieradata/private/<hostname>

elexis::trusted_hosts:
  elexis:
    hosts:
      - server
      - backup 
      - devel
  postgres:
    hosts:
      - server
      - backup 
      - devel
  vagrant:
    hosts:
      - server
      - backup 
      - devel

ssh::access::allow:
  - 'elexis'
  - 'vagrant'
#  - 'www-data'
#  - '@sysadmins'
ssh::access::deny:
  - 'mallory'
#  - '@dev'

# ssh::keys::www-data:
#   type: 'ssh-rsa'
#   public_key: 'AAAAB3NzaC1yc2EAAAABJQAAAQBaSth67VpPf6i737TWFYwBUwZdovDyfr2df94YbINWOkOQTBoaR5TnUSgqorpTUGmif8w2khqWWb/ZI+l5HQckR8WVVgBDnFPnXcYZ2ok0qV85bD/ttlpw4QDMb82+f72YcBu4h5A2eKxroqFQCyigfXtE3JjgakIm3iW7OW6XQUkAT8MZFhy3xlodJCdNOxvxawd9CVpw70cTeA7bXBiS8AFUpcKp20Z45tixiESrH2E4TRCy8HHxnN6fGUG+Xt6No265fPpEc+Bg+/hkrguIVEuj2NoIoQcS4F8Kew73jnJte4qugNbJIwcKTWn3NvgjA2CwPIWxvkvJerx129cf'

ssh::users:
#  www-data:
#    allow: [ 'elexis', 'www-data' ]
#    deny:  [ 'mallory' ]
#  tomcat1:
#    allow: [ 'elexis', 'www-data' ]
  
ssh::keys::elexis:
  type: 'ssh-rsa'
  public_key: 'AAAAB3NzaC1yc2EAAAABJQAAAQBaSth67VpPf6i737TWFYwBUwZdovDyfr2df94YbINWOkOQTBoaR5TnUSgqorpTUGmif8w2khqWWb/ZI+l5HQckR8WVVgBDnFPnXcYZ2ok0qV85bD/ttlpw4QDMb82+f72YcBu4h5A2eKxroqFQCyigfXtE3JjgakIm3iW7OW6XQUkAT8MZFhy3xlodJCdNOxvxawd9CVpw70cTeA7bXBiS8AFUpcKp20Z45tixiESrH2E4TRCy8HHxnN6fGUG+Xt6No265fPpEc+Bg+/hkrguIVEuj2NoIoQcS4F8Kew73jnJte4qugNbJIwcKTWn3NvgjA2CwPIWxvkvJerx129cf'

ssh::users:
  elexis:
    allow: [ 'elexis',] 
#    deny:  [ 'mallory' ]

# ensure that you can send mail via an sstmp user
# elexis::mail::user:      'put your username   into hieradata/private/config.yaml'
# elexis::mail::password:  'put your password   into hieradata/private/config.yaml'
# elexis::mail::smtp_host: 'put your smtp_host  into hieradata/private/config.yaml'

elexis::bin_dir:  /usr/local/bin
elexis::java:     'openjdk-6-jdk'
elexis::service_path: /var/lib/service
# This script must be normal bash scripts or we will have problem
elexis::install_script: 
server::reboot_script: '/usr/bin/sudo /sbin/shutdown -r -t 30 now'
server::halt_script:   '/usr/bin/sudo /sbin/shutdown -h -t 30 now'

# some parameters for PostgreSQL users. We assume that we want it
elexis::ensure: true
# next lines must be in sync with dbs
elexis::pg_main_db_name:     elexis
elexis::pg_tst_db_name:      test
elexis::pg_main_db_user:     elexis
elexis::pg_main_db_password: elexisTest

# Allows you to set parameters in pg_hba.conf    
pg::config_hash:
  ip_mask_deny_postgres_user: '0.0.0.0/32'
  ip_mask_allow_all_users:    '10.0.2.0/24'
  listen_addresses:           '*'
  manage_redhat_firewall:     false
  postgres_password:          postgres

# next line(s) go into /etc/postgresql/9.1/main/postgresql_puppet_extras.conf
pg::archive_timeout: 20s

pg::puppet_extras: "archive_command = '/usr/bin/test ! -f /home/backup-pg/wal/%f && /bin/cp %p /home/backup-pg/wal/%f < /dev/null'\n
archive_timeout = 20s\n
autovacuum =      on
"

# some parameters for MySQL users. We assume that we want 
mysql::server:root_password: elexisTest
elexis::ensure: true
elexis::mysql_main_db_name:     elexis
elexis::mysql_tst_db_name:      test
elexis::mysql_main_db_user:     elexis
elexis::mysql_main_db_password: elexisTest
elexis::mysql_dump_dir:         /home/mysql/dumps/
elexis::mysql_backup_dir:       /home/mysql/backups/
elexis::mysql_backup::files:    /home/mysql/dumps/elexis.dump*.gz

# Install Elexis and/or Medelexis current versions
elexis::install::OpenSource::ensure:     true
elexis::install::OpenSource::programURL: http://ftp.medelexis.ch/downloads_opensource/elexis/2.1.7.rc2/elexis-2.1.7.20121007-installer.jar
elexis::install::OpenSource::version:    2.1.7.rc2

elexis::install::Medelexis::ensure:      true
elexis::install::Medelexis::programURL:  http://www.medelexis.ch/dl21.php?file=medelexis-linux
elexis::install::Medelexis::version:     2.1.7.0

# What you prefer for your client
X::display_manager: slim
X::window_manager:  awesome

elexis::cockit::vcsRoot: /opt/src/elexis-cockpit

users:
  - 
    id: arzt
    name: "Dr. Max MÃ¼ller"
    mandant:  true
  - 
    id: mpa
    name: "Maria Bernasconi"
  
  